var AGStorage=function(){"use strict";function a(a,b,c){console.assert(a instanceof Storage,"storageObject should be Storage"),console.assert("string"==typeof b,"storageId should be string"),c&&console.assert("function"==typeof c,"dataChanged should be function"),this.storage=a,this.id=b,this.dataChanged=c}return a.prototype._setItem=function(a,b){console.assert("string"==typeof a,"key should be string"),this.storage.setItem(a,JSON.stringify(b))},a.prototype._getItem=function(a){console.assert("string"==typeof a,"key should be string");var b=this.storage.getItem(a);return b?JSON.parse(b):null},a.prototype._removeItem=function(a){console.assert("string"==typeof a,"key should be string"),this.storage.removeItem(a)},a.prototype._getRecordCounterKey=function(){return this.id+"-counter"},a.prototype._getRecordCounterValue=function(){var a=this._getItem(this._getRecordCounterKey());return a?parseInt(a,10):0},a.prototype._incRecordCounterValue=function(){var a=this._getRecordCounterValue()+1;return this._setItem(this._getRecordCounterKey(),a),a},a.prototype.getAllRecordIds=function(){var a=this._getItem(this.id);return a||[]},a.prototype._addRecordId=function(a){console.assert("string"==typeof a,"recordId should be string");var b=this.getAllRecordIds();b.push(a),this._setItem(this.id,b)},a.prototype._removeRecordId=function(a){console.assert("string"==typeof a,"recordId should be string");var b=this.getAllRecordIds(),c=b.indexOf(a);c>-1&&(b.splice(c,1),this._setItem(this.id,b))},a.prototype._getRecordKeyById=function(a){return console.assert("string"==typeof a,"recordId should be string"),this.id+"-"+a},a.prototype.createRecord=function(a){console.assert("object"==typeof a,"record should be object");var b=JSON.parse(JSON.stringify(a));return b.id=this._incRecordCounterValue().toString(),this._setItem(this._getRecordKeyById(b.id),b),this._addRecordId(b.id),this.dataChanged&&this.dataChanged(),b},a.prototype.updateRecord=function(a){this._setItem(this._getRecordKeyById(a.id),a),this.dataChanged&&this.dataChanged()},a.prototype.getRecordById=function(a){console.assert("string"==typeof a,"recordId should be string");var b=this._getItem(this._getRecordKeyById(a));return b||!1},a.prototype.getRecordByIndex=function(a){console.assert("number"==typeof a,"recordIndex should be number");var b=this.getAllRecordIds(),c=b[a],d=this._getItem(this._getRecordKeyById(c));return d||!1},a.prototype.forEachRecord=function(a,b){console.assert("function"==typeof a,"callback should be function");var d,e,c=this.getAllRecordIds();for(b="undefined"!=typeof b?b:0,d=b;d<c.length&&(e=this.getRecordById(c[d]),!a.bind(this)(e,d));d+=1);},a.prototype.getAllRecords=function(){var a=[];return this.forEachRecord(function(b){a.push(b)}),a},a.prototype.find=function(a,b,c){var d=-1;return this.forEachRecord(function(c,e){if(c.hasOwnProperty(a)&&JSON.stringify(c[a]).match(b))return d=e,!0},c),d},a.prototype.findBy=function(a,b){console.assert("function"==typeof a,"fn should be function");var c=-1;return this.forEachRecord(function(b,d){if(a(b,d))return c=d,!0},b),c},a.prototype.deleteRecordById=function(a){console.assert("string"==typeof a,"recordId should be string"),this._removeItem(this._getRecordKeyById(a)),this._removeRecordId(a),this.dataChanged&&this.dataChanged()},a.prototype.getDhtmlxGrid=function(a){var b,c=[];return this.forEachRecord(function(d){b=this.getDhtmlxGridRowByRecordId(d.id,a),c.push(b)}),{rows:c,total_count:c.length}},a.prototype.getDhtmlxGridRowByRecordId=function(a,b){console.assert("string"==typeof a,"recordId should be string");var c=this.getRecordById(a),d=[];return"undefined"==typeof b&&(b=Object.keys(c)),b.forEach(function(a){c.hasOwnProperty(a)&&d.push(c[a])}),{id:c.id,data:d}},a}(),AGTreeStorage=function(){"use strict";function a(a,b,c){this.storage=a,this.id=b,this._setItem(this.id+"-tree",!0),this.dataChanged=c}return a.prototype=Object.create(AGStorage.prototype),a.prototype.constructor=a,a}();